<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better Me</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- 이미지 캡처 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <h1><i class="fas fa-magic"></i> 더 나은 나로 한 걸음, Better Me</h1>
        <p>AI가 분석하고 개선 방안을 제시합니다</p>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="main-content">
            <!-- 단계별 진행 표시 -->
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">사진 활용 동의</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">결제</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">사진 업로드</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">AI 분석</div>
                </div>
                <div class="step" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-label">피드백 제공</div>
                </div>
                <div class="step" data-step="6">
                    <div class="step-number">6</div>
                    <div class="step-label">메이크업 팁</div>
                </div>
            </div>

            <!-- 단계별 컨텐츠 -->
            <div class="step-content">
                <!-- 1단계: 사진 활용 동의 -->
                <div class="step-panel active" id="step-1">
                    <h2>사진 활용 동의</h2>
                    <div class="consent-form">
                        <div class="consent-info">
                            <h3>AI 외모 분석 서비스 이용약관</h3>
                            <div class="terms-content">
                                <p>본 서비스는 고객님께서 업로드하신 사진을 AI 기술을 통해 분석하여 외모 개선 방안을 제시하는 서비스입니다.</p>
                                
                                <h4>1. 사진 활용 목적</h4>
                                <ul>
                                    <li>AI 기반 외모 분석 및 평가</li>
                                    <li>개인 맞춤형 피드백 제공</li>
                                    <li>개선된 이미지 생성</li>
                                </ul>
                                
                                <h4>2. 개인정보 보호</h4>
                                <ul>
                                    <li>업로드된 사진은 분석 목적으로만 사용됩니다</li>
                                    <li>사진은 서버에 저장되지 않으며 분석 완료 후 즉시 삭제됩니다</li>
                                    <li>제3자에게 제공되지 않습니다</li>
                                </ul>
                                
                                <h4>3. 서비스 이용</h4>
                                <ul>
                                    <li>본 동의는 서비스 이용을 위한 필수 사항입니다</li>
                                    <li>동의하지 않을 경우 서비스를 이용할 수 없습니다</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="consent-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="photo-consent" required>
                                <span class="checkmark"></span>
                                사진 활용 및 개인정보 처리에 동의합니다
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="service-terms" required>
                                <span class="checkmark"></span>
                                서비스 이용약관에 동의합니다
                            </label>
                        </div>
                        
                        <div class="step-buttons-center">
                            <button class="btn btn-primary" onclick="nextStep()">다음 단계</button>
                        </div>
                    </div>
                </div>

                <!-- 2단계: 결제 -->
                <div class="step-panel" id="step-2">
                    <h2>결제</h2>
                    <div class="payment-section">
                        <div class="payment-info">
                            <h3>AI 외모 진단 및 메이크업 팁 서비스</h3>
                            <div class="service-details">
                                <div class="service-item">
                                    <i class="fas fa-robot"></i>
                                    <span>AI 외모 분석</span>
                                    <span class="price">₩1,500</span>
                                </div>
                                <div class="service-item">
                                    <i class="fas fa-palette"></i>
                                    <span>맞춤형 메이크업 팁</span>
                                    <span class="price">₩1,500</span>
                                </div>
                                <div class="service-item total">
                                    <i class="fas fa-calculator"></i>
                                    <span>총 결제 금액</span>
                                    <span class="price total-price">₩3,000</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="payment-methods">
                            <h3>결제 방법 선택</h3>
                            <div class="payment-option">
                                <input type="radio" id="card-payment" name="payment-method" value="card" checked onchange="togglePaymentForm()">
                                <label for="card-payment">
                                    <i class="fas fa-credit-card"></i>
                                    신용카드/체크카드
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" id="bank-transfer" name="payment-method" value="transfer" onchange="togglePaymentForm()">
                                <label for="bank-transfer">
                                    <i class="fas fa-university"></i>
                                    계좌이체
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" id="mobile-payment" name="payment-method" value="mobile" onchange="togglePaymentForm()">
                                <label for="bank-transfer">
                                    <i class="fas fa-mobile-alt"></i>
                                    모바일 결제
                                </label>
                            </div>
                        </div>
                        
                        <div class="payment-form" id="card-payment-form">
                            <h3>카드 정보 입력</h3>
                            <div class="form-group">
                                <label for="card-number">카드 번호</label>
                                <input type="text" id="card-number" placeholder="1234-5678-9012-3456" maxlength="19" oninput="formatCardNumber(this)">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expiry-date">만료일</label>
                                    <input type="text" id="expiry-date" placeholder="MM/YY" maxlength="5" oninput="formatExpiryDate(this)">
                                </div>
                                <div class="form-group">
                                    <label for="cvv">CVV</label>
                                    <input type="text" id="cvv" placeholder="123" maxlength="3" oninput="formatCVV(this)">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="card-holder">카드 소유자명</label>
                                <input type="text" id="card-holder" placeholder="홍길동">
                            </div>
                        </div>
                        
                        <div class="payment-form" id="transfer-payment-form" style="display: none;">
                            <h3>계좌이체 정보</h3>
                            <div class="bank-info">
                                <p><strong>은행:</strong> 신한은행</p>
                                <p><strong>계좌번호:</strong> 110-123-456789</p>
                                <p><strong>예금주:</strong> (주)뷰티AI</p>
                                <p><strong>입금 확인 후 서비스가 시작됩니다.</strong></p>
                            </div>
                        </div>
                        
                        <div class="payment-form" id="mobile-payment-form" style="display: none;">
                            <h3>모바일 결제</h3>
                            <div class="mobile-payment-info">
                                <p>모바일 결제는 별도 앱을 통해 진행됩니다.</p>
                                <button class="btn btn-primary" onclick="processMobilePayment()">
                                    <i class="fas fa-mobile-alt"></i> 모바일 결제 시작
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-buttons">
                        <button class="btn btn-secondary" onclick="prevStep()">이전 단계</button>
                        <button class="btn btn-primary" onclick="processPayment()" id="payment-button">
                            <i class="fas fa-credit-card"></i> 결제하기
                        </button>
                    </div>
                </div>

                <!-- 3단계: 사진 업로드 -->
                <div class="step-panel" id="step-3">
                    <h2>사진 업로드</h2>
                    <div class="upload-instructions">
                        <h3>3장의 사진을 업로드해주세요</h3>
                        <p>더 정확한 AI 분석을 위해 다음 3장의 사진이 필요합니다:</p>
                    </div>
                    
                    <div class="upload-grid">
                        <!-- 정면 사진 -->
                        <div class="upload-item">
                            <h4><i class="fas fa-user"></i> 정면 사진</h4>
                            <div class="upload-zone" id="upload-zone-front" data-type="front" onclick="document.getElementById('photo-input-front').click()" ondrop="handleDrop(event, 'front')" ondragover="handleDragOver(event)">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>정면을 향한 사진</p>
                                <p class="upload-hint">얼굴이 정면을 향하고 있어야 합니다</p>
                            </div>
                            <input type="file" id="photo-input-front" accept="image/*" capture="user" style="display: none;" onchange="handleFileUpload(event, 'front')">
                            <div class="uploaded-image" id="uploaded-image-front" style="display: none;">
                                <img id="preview-image-front" src="" alt="정면 사진">
                                <button class="btn btn-secondary btn-sm" onclick="removeImage('front')">제거</button>
                            </div>
                        </div>
                        
                        <!-- 45도 측면 사진 -->
                        <div class="upload-item">
                            <h4><i class="fas fa-user-friends"></i> 45도 측면 사진</h4>
                            <div class="upload-zone" id="upload-zone-45" data-type="45" onclick="document.getElementById('photo-input-45').click()" ondrop="handleDrop(event, '45')" ondragover="handleDragOver(event)">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>45도 측면 사진</p>
                                <p class="upload-hint">얼굴이 45도 각도로 보여야 합니다</p>
                            </div>
                            <input type="file" id="photo-input-45" accept="image/*" capture="user" style="display: none;" onchange="handleFileUpload(event, '45')">
                            <div class="uploaded-image" id="uploaded-image-45" style="display: none;">
                                <img id="preview-image-45" src="" alt="45도 측면 사진">
                                <button class="btn btn-secondary btn-sm" onclick="removeImage('45')">제거</button>
                            </div>
                        </div>
                        
                        <!-- 90도 측면 사진 -->
                        <div class="upload-item">
                            <h4><i class="fas fa-user-secret"></i> 90도 측면 사진</h4>
                            <div class="upload-zone" id="upload-zone-90" data-type="90" onclick="document.getElementById('photo-input-90').click()" ondrop="handleDrop(event, '90')" ondragover="handleDragOver(event)">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>90도 측면 사진</p>
                                <p class="upload-hint">얼굴이 완전히 측면으로 보여야 합니다</p>
                            </div>
                            <input type="file" id="photo-input-90" accept="image/*" capture="user" style="display: none;" onchange="handleFileUpload(event, '90')">
                            <div class="uploaded-image" id="uploaded-image-90" style="display: none;">
                                <img id="preview-image-90" src="" alt="90도 측면 사진">
                                <button class="btn btn-secondary btn-sm" onclick="removeImage('90')">제거</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="upload-requirements">
                        <h3>업로드 요구사항</h3>
                        <ul>
                            <li>얼굴이 명확하게 보이는 고화질 사진</li>
                            <li>자연광이 충분한 환경에서 촬영</li>
                            <li>화장이나 필터가 없는 상태</li>
                            <li>각도별로 명확하게 구분되는 사진</li>
                            <li>최대 10MB, JPG, PNG, WEBP 지원</li>
                        </ul>
                    </div>
                    
                    <div class="step-buttons-center">
                        <button class="btn btn-primary" onclick="nextStep()" id="next-step-3" disabled>다음 단계</button>
                    </div>
                </div>

                <!-- 4단계: AI 분석 로딩 -->
                <div class="step-panel" id="step-4">
                    <h2>AI가 이미지를 분석하고 있습니다...</h2>
                    <div class="loading-page">
                        <div class="loading-content">
                            <div class="loading-spinner"></div>
                            <h3>잠시만 기다려주세요. 정밀한 검사를 진행하고 있습니다.</h3>
                            
                            <!-- 진행률 바 추가 -->
                            <div class="progress-container">
                                <!-- 진행률 바 -->
                                <div class="progress-bar">
                                    <div class="progress-fill" id="analysis-progress-fill"></div>
                                </div>
                                
                                <!-- 간단한 진행 텍스트 -->
                                <div class="progress-text" id="analysis-progress-text">분석 준비 중<span class="loading-dots" id="loading-dots"></span></div>
                            </div>
                            

                        </div>
                    </div>
                </div>

                        <!-- 5단계: 피드백 제공 -->
        <div class="step-panel" id="step-5">
                    <h2>AI 브랜딩 실장이 바라본 당신의 얼굴</h2>
                    
                    <!-- 업로드된 이미지들 표시 -->
                    <div class="uploaded-image-section">
                        <h3><i class="fas fa-image"></i> 분석된 이미지들</h3>
                        <div class="analysis-images-grid">
                            <div class="analysis-image-item">
                                <h4><i class="fas fa-user"></i> 정면 사진</h4>
                                <img id="step5-uploaded-image-front" src="" alt="정면 사진" class="analysis-image">
                            </div>
                            <div class="analysis-image-item">
                                <h4><i class="fas fa-user-friends"></i> 45도 측면 사진</h4>
                                <img id="step5-uploaded-image-45" src="" alt="45도 측면 사진" class="analysis-image">
                            </div>
                            <div class="analysis-image-item">
                                <h4><i class="fas fa-user-secret"></i> 90도 측면 사진</h4>
                                <img id="step5-uploaded-image-90" src="" alt="90도 측면 사진" class="analysis-image">
                            </div>
                        </div>
                    </div>
                    
                    <div class="feedback-container">
                        <div class="feedback-details">
                            <div class="complete-analysis">
                                <div class="point-display" id="point-display">
                                    <!-- 포인트가 여기에 큰 폰트로 표시됩니다 -->
                                </div>
                                <h4><i class="fas fa-clipboard-list"></i> 전체 분석 결과</h4>
                                <div class="analysis-content" id="complete-analysis-content">
                                    <p>분석 결과를 기다리는 중...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-buttons">
                        <button class="btn btn-secondary" onclick="saveStep5AsImage()" id="save-step5">
                            <i class="fas fa-image"></i> 이미지로 저장하기
                        </button>
                        <button class="btn btn-primary" onclick="nextStep()" id="next-step-5">다음 단계</button>
                    </div>
                </div>

                        <!-- 6단계: 메이크업 및 시술 팁 -->
        <div class="step-panel" id="step-6">
                    <h2>AI 메이크업 실장의 맞춤형 조언</h2>
                    
                    <!-- 업로드된 이미지들 표시 -->
                    <div class="uploaded-image-section">
                        <h3><i class="fas fa-image"></i> 분석된 이미지들</h3>
                        <div class="analysis-images-grid">
                            <div class="analysis-image-item">
                                <h4><i class="fas fa-user"></i> 정면 사진</h4>
                                <img id="step6-uploaded-image-front" src="" alt="정면 사진" class="analysis-image">
                            </div>
                            <div class="analysis-image-item">
                                <h4><i class="fas fa-user-friends"></i> 45도 측면 사진</h4>
                                <img id="step6-uploaded-image-45" src="" alt="45도 측면 사진" class="analysis-image">
                            </div>
                            <div class="analysis-image-item">
                                <h4><i class="fas fa-user-secret"></i> 90도 측면 사진</h4>
                                <img id="step6-uploaded-image-90" src="" alt="90도 측면 사진" class="analysis-image">
                            </div>
                        </div>
                    </div>
                    
                    <div class="feedback-container">
                        <div class="feedback-details">
                            <div class="complete-analysis">
                                <div class="point-display" id="makeup-point-display">
                                    <!-- 메이크업 팁 포인트가 여기에 큰 폰트로 표시됩니다 -->
                                </div>
                                <h4><i class="fas fa-magic"></i> AI 메이크업 실장의 맞춤형 조언</h4>
                                <div class="analysis-content" id="makeup-tips-content">
                                    <p>메이크업 팁을 기다리는 중...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-buttons">
                        <button class="btn btn-secondary" onclick="prevStep()">이전 단계</button>
                        <button class="btn btn-success" onclick="saveAsImages()">
                            <i class="fas fa-image"></i> 이미지로 저장하기
                        </button>
                    </div>
                </div>
            </div>
        </main>

    <!-- 푸터 -->
    <footer class="footer">
        <p>&copy; Better Me 개인정보는 이용 후 바로 삭제됩니다.</p>
    </footer>

    <!-- 로딩 모달 -->
    <div class="modal" id="loading-modal">
        <div class="modal-content">
            <div class="spinner"></div>
            <p id="modal-message">처리 중입니다...</p>
        </div>
    </div>

    <!-- html2canvas 라이브러리 추가 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script src="script.js"></script>
    <script>
        // 디버깅을 위한 콘솔 로그
        console.log('Better U 앱이 로드되었습니다.');
        console.log('현재 단계:', 1);
        
        // 전역 함수들을 콘솔에서 테스트할 수 있도록 노출
        window.testApp = {
            nextStep: window.nextStep,
            prevStep: window.prevStep,
            currentStep: () => window.currentStep
        };
        
        // 3단계 버튼 클릭 테스트 함수
        window.testStep3 = function() {
            console.log('=== 3단계 버튼 클릭 테스트 ===');
            console.log('현재 currentStep:', window.currentStep);
            console.log('3단계 버튼 존재 여부:', !!document.getElementById('next-step-3'));
            console.log('3단계 버튼 onclick 속성:', document.getElementById('next-step-3')?.onclick);
            console.log('3단계 버튼 HTML:', document.getElementById('next-step-3')?.outerHTML);
            
            // 3단계로 강제 이동
            window.currentStep = 3;
            console.log('currentStep을 3으로 설정 완료');
            
            // 3단계 패널 표시
            const step3Panel = document.getElementById('step-3');
            if (step3Panel) {
                document.querySelectorAll('.step-panel').forEach(panel => panel.classList.remove('active'));
                step3Panel.classList.add('active');
                console.log('3단계 패널 활성화 완료');
            }
            
            // 진행 단계 업데이트
            if (window.updateProgressSteps) {
                window.updateProgressSteps();
                console.log('진행 단계 업데이트 완료');
            }
        };
        
        // 오류 처리
        window.addEventListener('error', function(e) {
            console.error('전역 오류 발생:', e.error);
            alert('앱에서 오류가 발생했습니다. 콘솔을 확인해주세요.');
        });
        
        // Promise 오류 처리
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise 오류 발생:', e.reason);
            alert('비동기 작업에서 오류가 발생했습니다. 콘솔을 확인해주세요.');
        });
        
        // 페이지 언로드 시 상태 저장
        window.addEventListener('beforeunload', function() {
            if (window.saveAppState) {
                window.saveAppState();
            }
        });
    </script>
</body>
</html>
