<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better Me</title>
    <link rel="stylesheet" href="styles.css?v=18">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- 이미지 캡처 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BVF6W1YC2F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);} 
      gtag('js', new Date());
      gtag('config', 'G-BVF6W1YC2F');
    </script>
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <div class="logo-container">
            <img src="better-me-logo.png" alt="Better Me" class="main-logo">
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="main-content">
            <!-- 단계별 진행 표시 -->
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">사진 활용 동의</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">사진 업로드</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">AI 분석</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">피드백 제공</div>
                </div>
            </div>

            <!-- 단계별 컨텐츠 -->
            <div class="step-content">
                <!-- 1단계: Better Me 서비스 이용 약관 -->
                <div class="step-panel active" id="step-1">
                    <h2>서비스 이용약관</h2>
                    <p class="terms-subtitle">*중요내용만 추려뒀어요!</p>
                    
                    <!-- 약관동의 체크박스 -->
                    <div class="terms-consent-section">
                        
                        <div class="terms-content">
                            <div class="terms-item">
                                <h4><input type="checkbox" id="service-terms" required> 서비스 이용약관 동의 <a href="#" class="terms-link">(보기)</a></h4>
                                <ul>
                                    <li>AI 기반 외모 분석 및 평가</li>
                                    <li>개인 맞춤형 피드백 제공</li>
                                    <li>개선된 이미지 생성</li>
                                </ul>
                            </div>
                            
                            <div class="terms-item">
                                <h4><input type="checkbox" id="privacy-consent" required> 개인정보 수집·이용 동의 <a href="#" class="terms-link">(보기)</a></h4>
                                <ul>
                                    <li>업로드된 사진은 분석 목적으로만 사용됩니다</li>
                                </ul>
                            </div>
                            
                            <div class="terms-item">
                                <h4><input type="checkbox" id="privacy-transfer" required> 개인정보의 외부 전송·제공 동의 <a href="privacy-transfer.html" target="_blank" class="terms-link">(보기)</a></h4>
                                <ul>
                                    <li>서버로 전송된 사진은 분석 30일 후 완전 삭제됩니다</li>
                                </ul>
                            </div>
                        </div>
                        
                    </div>
                    
                    <div class="step-buttons-center">
                        <button class="btn btn-primary" id="next-step-2" onclick="nextStep()" disabled>다음 단계</button>
                    </div>
                </div>


                <!-- 2단계: 사진 업로드 -->
                <div class="step-panel" id="step-2">
                    <h2>사진 업로드</h2>
                    
                    <div class="upload-requirements">
                        <ul>
                            <li>얼굴 분석은 메이크업하지 않은 맨 얼굴로 진행됩니다</li>
                            <li>머리를 묶어 이목구비를 가리지 않도록 해주세요</li>
                            <li>사진 촬영을 통해 분석이 진행되니 카메라 렌즈가 깨끗한지 확인해주세요</li>
                            <li>분석은 총 1~3분 소요됩니다</li>
                        </ul>
                    </div>
                    
                    <div class="upload-grid">
                        <!-- 정면 사진 -->
                        <div class="upload-item">
                            <h4><i class="fas fa-user"></i> 정면 사진</h4>
                            <div class="upload-zone" id="upload-zone-front" data-type="front" onclick="document.getElementById('photo-input-front').click()" ondrop="handleDrop(event, 'front')" ondragover="handleDragOver(event)">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>정면을 향한 사진</p>
                                <p class="upload-hint">얼굴이 정면을 향하고 있어야 합니다</p>
                            </div>
                            <input type="file" id="photo-input-front" accept="image/*" capture="user" style="display: none;" onchange="handleFileUpload(event, 'front')">
                            <div class="uploaded-image" id="uploaded-image-front" style="display: none;">
                                <img id="preview-image-front" src="" alt="정면 사진">
                                <button class="btn btn-secondary btn-sm" onclick="removeImage('front')">제거</button>
                            </div>
                        </div>
                        
                        <!-- 45도 측면 사진 -->
                        <div class="upload-item">
                            <h4><i class="fas fa-user-friends"></i> 45도 측면 사진</h4>
                            <div class="upload-zone" id="upload-zone-45" data-type="45" onclick="document.getElementById('photo-input-45').click()" ondrop="handleDrop(event, '45')" ondragover="handleDragOver(event)">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>45도 측면 사진</p>
                                <p class="upload-hint">얼굴이 45도 각도로 보여야 합니다</p>
                            </div>
                            <input type="file" id="photo-input-45" accept="image/*" capture="user" style="display: none;" onchange="handleFileUpload(event, '45')">
                            <div class="uploaded-image" id="uploaded-image-45" style="display: none;">
                                <img id="preview-image-45" src="" alt="45도 측면 사진">
                                <button class="btn btn-secondary btn-sm" onclick="removeImage('45')">제거</button>
                            </div>
                        </div>
                        
                        <!-- 90도 측면 사진 -->
                        <div class="upload-item">
                            <h4><i class="fas fa-user-secret"></i> 90도 측면 사진</h4>
                            <div class="upload-zone" id="upload-zone-90" data-type="90" onclick="document.getElementById('photo-input-90').click()" ondrop="handleDrop(event, '90')" ondragover="handleDragOver(event)">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>90도 측면 사진</p>
                                <p class="upload-hint">얼굴이 완전히 측면으로 보여야 합니다</p>
                            </div>
                            <input type="file" id="photo-input-90" accept="image/*" capture="user" style="display: none;" onchange="handleFileUpload(event, '90')">
                            <div class="uploaded-image" id="uploaded-image-90" style="display: none;">
                                <img id="preview-image-90" src="" alt="90도 측면 사진">
                                <button class="btn btn-secondary btn-sm" onclick="removeImage('90')">제거</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-buttons-center">
                        <button class="btn btn-primary" onclick="nextStep()" id="next-step-3" disabled>다음 단계</button>
                    </div>
                </div>

                <!-- 3단계: AI 분석 로딩 -->
                <div class="step-panel" id="step-3">
                    <h2>AI가 이미지를 분석하고 있습니다...</h2>
                    <div class="loading-page">
                        <div class="loading-content">
                            <div class="loading-spinner"></div>
                            <h3>1~2분간 정밀한 분석이 진행됩니다</h3>
                            
                            <!-- 진행률 바 추가 -->
                            <div class="progress-container">
                                <!-- 진행률 바 -->
                                <div class="progress-bar">
                                    <div class="progress-fill" id="analysis-progress-fill"></div>
                                </div>
                                
                                <!-- 간단한 진행 텍스트 -->
                                <div class="progress-text" id="analysis-progress-text">분석 준비 중<span class="loading-dots" id="loading-dots"></span></div>
                            </div>
                            

                        </div>
                    </div>
                </div>

                        <!-- 5단계: 피드백 제공 -->
        <div class="step-panel" id="step-4">
            <h2>얼굴분석 결과</h2>
            
            <!-- 업로드된 이미지들 표시 -->
            <div class="uploaded-image-section">
                <h3><i class="fas fa-image"></i> 분석된 이미지들</h3>
                <div class="analysis-images-grid">
                    <div class="analysis-image-item">
                        <h4><i class="fas fa-user"></i> 정면 사진</h4>
                        <img id="step4-uploaded-image-front" src="" alt="정면 사진" class="analysis-image">
                    </div>
                    <div class="analysis-image-item">
                        <h4><i class="fas fa-user-friends"></i> 45도 측면 사진</h4>
                        <img id="step4-uploaded-image-45" src="" alt="45도 측면 사진" class="analysis-image">
                    </div>
                    <div class="analysis-image-item">
                        <h4><i class="fas fa-user-secret"></i> 90도 측면 사진</h4>
                        <img id="step4-uploaded-image-90" src="" alt="90도 측면 사진" class="analysis-image">
                    </div>
                </div>
            </div>
            
            <div class="feedback-container">
                <div class="feedback-details">
                    <div class="complete-analysis">
                        <div class="point-display" id="point-display">
                            <!-- 포인트가 여기에 큰 폰트로 표시됩니다 -->
                        </div>
                        <h4><i class="fas fa-clipboard-list"></i> 전체 분석 결과</h4>
                        <div class="analysis-content" id="complete-analysis-content">
                            <p>분석 결과를 기다리는 중...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step-buttons">
                <button class="btn btn-success" onclick="saveStep5AsImage()" id="save-step5">
                    <i class="fas fa-image"></i> 이미지로 저장하기
                </button>
            </div>
        </div>

            </div>
        </main>

    <!-- 푸터 -->
    <footer class="footer">
        <p>&copy; Better Me 개인정보는 이용 후 바로 삭제됩니다.</p>
    </footer>

    <!-- 로딩 모달 -->
    <div class="modal" id="loading-modal">
        <div class="modal-content">
            <div class="spinner"></div>
            <p id="modal-message">처리 중입니다...</p>
        </div>
    </div>

    <!-- html2canvas 라이브러리 추가 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script src="script.js"></script>
    <script>
        
        // 디버깅을 위한 콘솔 로그
        console.log('Better U 앱이 로드되었습니다.');
        console.log('현재 단계:', 1);
        
        // 전역 함수들을 콘솔에서 테스트할 수 있도록 노출
        window.testApp = {
            nextStep: window.nextStep,
            prevStep: window.prevStep,
            currentStep: () => window.currentStep
        };
        
        // 3단계 버튼 클릭 테스트 함수
        window.testStep3 = function() {
            console.log('=== 3단계 버튼 클릭 테스트 ===');
            console.log('현재 currentStep:', window.currentStep);
            console.log('3단계 버튼 존재 여부:', !!document.getElementById('next-step-3'));
            console.log('3단계 버튼 onclick 속성:', document.getElementById('next-step-3')?.onclick);
            console.log('3단계 버튼 HTML:', document.getElementById('next-step-3')?.outerHTML);
            
            // 3단계로 강제 이동
            window.currentStep = 3;
            console.log('currentStep을 3으로 설정 완료');
            
            // 3단계 패널 표시
            const step3Panel = document.getElementById('step-3');
            if (step3Panel) {
                document.querySelectorAll('.step-panel').forEach(panel => panel.classList.remove('active'));
                step3Panel.classList.add('active');
                console.log('3단계 패널 활성화 완료');
            }
            
            // 진행 단계 업데이트
            if (window.updateProgressSteps) {
                window.updateProgressSteps();
                console.log('진행 단계 업데이트 완료');
            }
        };
        
        // 오류 처리
        window.addEventListener('error', function(e) {
            console.error('전역 오류 발생:', e.error);
            alert('앱에서 오류가 발생했습니다. 콘솔을 확인해주세요.');
        });
        
        // Promise 오류 처리
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise 오류 발생:', e.reason);
            alert('비동기 작업에서 오류가 발생했습니다. 콘솔을 확인해주세요.');
        });
        
        // 페이지 언로드 시 상태 저장
        window.addEventListener('beforeunload', function() {
            if (window.saveAppState) {
                window.saveAppState();
            }
        });
    </script>
</body>
</html>
